{"name":"Death Kiss Blade v2","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/009-death-kiss-blade/art-static-death-kiss-blade.webp","system":{"description":{"value":"<h4><em>Weapon (longsword), very rare (requires attunement)</em></h4><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“I saw them surrounding the warrior who stood motionless with his black sword in hand, sheathed. Suddenly, they started falling to the ground. The attack was so fast that they didn’t even know what happened. The warrior, standing in the same place, this time holding the scabbard with one hand and the sword, which was full of blood, with the other, looking at me said, ‘go and tell those who want to face me that they will have the same fate’ and then I ran…”</em></p></div><hr /><h4>You gain a +1 bonus to attack and damage rolls made with this magic weapon.</h4><hr /><h4>The guard is crafted in the shape of a skull, its eye sockets glowing with an eerie red light. The blade itself is long and sleek, with a deadly razor-sharp edge.</h4><h4><strong>Finesse.</strong> When making an attack with a finesse weapon, you use your choice of your Strength or Dexterity modifier for the attack and damage rolls. You must use the same modifier for both rolls.</h4><h4><strong>Versatile.</strong> This weapon can be used with one or two hands. A damage value in parentheses appears with the property—the damage when the weapon is used with two hands to make a melee attack.</h4><hr /><h4><strong>Death Kiss Attack (Active Ability)</strong>: As an action you can perform this attack technique. You move so fast that you can make a single melee attack on all enemies within 20 feet of you in an instant. You can use this ability again after a long rest.</h4><img src=\"modules/boss-loot-magic-items-free/artwork/009-death-kiss-blade/art-static-death-kiss-blade.webp\" alt=\"Death Kiss Blade\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":2,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"veryRare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":5,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"mwak","attackBonus":"1","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d8 + @mod +1","slashing"]],"versatile":"1d10 + @mod +1"},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":10},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"weaponType":"martialM","baseItem":"longsword","properties":{"ver":true,"amm":false,"hvy":false,"fin":true,"fir":false,"foc":false,"lgt":false,"lod":false,"rch":false,"rel":false,"ret":false,"spc":false,"thr":false,"two":false,"mgc":true,"ada":false,"sil":false},"proficient":false},"effects":[{"label":"Death Kiss Blade (do not touch this)","icon":"modules/boss-loot-magic-items-free/artwork/009-death-kiss-blade/art-static-death-kiss-blade.webp","origin":"Item.lCOB8K8gXKy2YCcX","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"fN8lKA87GOlGKsAy","changes":[],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":"test"},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onDelete":{"script":"const itemName = \"Death Kiss Blade\";\nconst featName = \"Death Kiss Attack (Active Ability)\";\n\nlet myItems = actor.items;\n\n// Remove the item from item list\nmyItems.forEach(async function (item) {\n  item.name === featName && item.type === \"feat\" && (await actor.deleteEmbeddedDocuments(\"Item\", [item.id]));\n});\n"},"onEnable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Death Kiss Blade\";\nconst featName = \"Death Kiss Attack (Active Ability)\";\nconst myItems = actor.items;\nlet featExists = false;\n\nmyItems.forEach(function (item) {\n  if (item.name === featName && item.type === \"feat\") {\n    console.log(`${orgName} | A feature with name ${featName} already exists!`);\n    featExists = true;\n  }\n});\n\nif (featExists) {\n  return;\n}\n\nconst artWorkChatTitle = \"modules/boss-loot-magic-items-free/artwork/009-death-kiss-blade/art-static-for-death-kiss-attack.webp\";\n\nconst deathKissFeat = {\n  name: featName,\n  type: \"feat\",\n  system: {\n    description: {\n      value:\n        '<p><span class=\"ryNqvb\"><strong>Death Kiss Attack (Active Ability)</strong>: </span><span class=\"ryNqvb\">As an action you can perform this attack technique.</span> <span class=\"ryNqvb\">You move so fast that you can make a single melee attack on all enemies within 20 feet of you in an instant.</span></p>',\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: \"Death Kiss Blade\",\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"1\",\n      units: \"turn\",\n    },\n    target: {\n      value: 20,\n      width: null,\n      units: \"ft\",\n      type: \"enemy\",\n    },\n    range: {\n      value: null,\n      long: null,\n      units: \"spec\",\n    },\n    uses: {\n      value: 1,\n      max: \"1\",\n      per: \"lr\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"mwak\",\n    attackBonus: \"1\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [[\"1d8 + @mod + 1\", \"slashing\"]],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    type: {\n      value: \"\",\n      subtype: \"\",\n    },\n    requirements: \"\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  img: artWorkChatTitle,\n  effects: [],\n  folder: null,\n  sort: 0,\n  ownership: {\n    default: 0,\n  },\n  flags: {\n    \"midi-qol\": {\n      fumbleThreshold: null,\n      effectActivation: false,\n      onUseMacroName: \"[postAttackRoll]ItemMacro\",\n    },\n    midiProperties: {\n      nodam: false,\n      fulldam: false,\n      halfdam: false,\n      rollOther: false,\n      critOther: false,\n      magicdam: false,\n      magiceffect: false,\n      concentration: false,\n      toggleEffect: false,\n      autoFailFriendly: false,\n      offHandWeapon: false,\n      ignoreTotalCover: false,\n      autoSaveFriendly: false,\n    },\n    itemacro: {\n      macro: {\n        name: \"Death Kiss Attack (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.deathKissAbility.itemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n        flags: {},\n      },\n    },\n  },\n};\nawait actor.createEmbeddedDocuments(\"Item\", [deathKissFeat]);\n"},"onDisable":{"script":"const itemName = \"Death Kiss Blade\";\nconst featName = \"Death Kiss Attack (Active Ability)\";\n\nlet myItems = actor.items;\n\n// Remove the item from item list\nmyItems.forEach(async function (item) {\n  item.name === featName && item.type === \"feat\" && (await actor.deleteEmbeddedDocuments(\"Item\", [item.id]));\n});\n"}}}}],"flags":{"core":{"sourceId":"Compendium.dnd5e.items.IPkf0XNowClwXnjQ"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[postAttackRoll]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"autoFailFriendly":false,"offHandWeapon":false,"ignoreTotalCover":false,"autoSaveFriendly":false},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"},"itemacro":{"macro":{"name":"Death Kiss Blade v2","type":"script","scope":"global","command":"const orgName = \"Boss Loot\";\nconst info = args[0];\nlet targetTokens = info.targets;\n\nasync function hideDivFromChatMessage(cardId, className) {\n  const chatMessage = game.messages.get(cardId);\n  const tempDiv = document.createElement(\"div\");\n  tempDiv.innerHTML = chatMessage.content;\n\n  const midiQolSavesDisplay = tempDiv.querySelector(className);\n  midiQolSavesDisplay?.classList.add(\"hidden\");\n\n  console.log(`${orgName} | Add class hidden to Saves Display in ChatMessage with id ${cardId}`);\n  await chatMessage.update({ content: tempDiv.innerHTML });\n}\n\nif (targetTokens.length !== 1) {\n  console.log(`${orgName} | Please select one target`);\n  ui.notifications.warn(`Please select one target!`);\n  await hideDivFromChatMessage(info.itemCardId, \".card-buttons\");\n  return;\n}\n\n[target] = targetTokens;\n\nnew Sequence().effect().file(\"jb2a.greatsword.melee.standard.white\").atLocation(token).stretchTo(target).template({ gridSize: 200, startPoint: 200, endPoint: 200 }).timeRange(1400, 2500).play();","author":"Iz3BYZWrVGwLMHiJ","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"scene-packer":{"sourceId":"Item.lvjWAghFICcUtQ0g"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1661787233572,"modifiedTime":1687072914116,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"04wON5WSa5Mni8em"}
{"name":"Tertius Portal Dagger v3","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-tertius.webp","system":{"description":{"value":"<p><em>Weapon (dagger), rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“The four ancient knives, whose power spans the planes of existence, are said to contain a secret knowledge that is older than time itself. Those who unlock their secrets will gain access to a realm of power and knowledge beyond the comprehension of mortal minds.”</em></p></div><hr /><p>You gain a +2 bonus to attack and damage rolls made with this magic weapon.</p><p>The Prime, Secundus, Tertius, and Quartus knives are powerful items, each imbued with a unique ability to open a portal to the next knife’s location. When inserted into any wall, the Prime knife will open a portal to the Secundus knife, the Secundus knife will open a portal to the Tertius knife, and so on. With the Quartus knife, the portal will take the user back to the location of the Prime knife.</p><p>A strong connection is formed between you and the dagger once the portal is opened and only you can retrieve the blade from its resting place.</p><img src=\"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-tertius.webp\" alt=\"Tertius Dagger\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":1,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"rare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":20,"long":60,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"mwak","attackBonus":"2","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + @mod +2","piercing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":10},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"weaponType":"simpleM","baseItem":"dagger","properties":{"fin":true,"lgt":true,"thr":true,"amm":false,"hvy":false,"fir":false,"foc":false,"lod":false,"rch":false,"rel":false,"ret":false,"spc":false,"two":false,"ver":false,"mgc":true,"ada":false,"sil":false},"proficient":true},"effects":[{"label":"Tertius Portal Effect (do not touch this)","icon":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-tertius.webp","origin":"Item.WF3F3VMEhSon2nFg","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"1LWiMPoAc26KvC8x","changes":[],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":"Creates the gate to Quartus"},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onDelete":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Tertius Portal Dagger\";\nconst featName = \"Tertius Portal (Active Ability)\";\n\nconst tertiusPortalfeat = actor.items.getName(featName);\nif (tertiusPortalfeat) {\n  await tertiusPortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"},"onEnable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Tertius Portal Dagger v3\";\nconst featName = \"Tertius Portal (Active Ability)\";\nconst itemNameNormalized = \"Tertius Portal Dagger\";\nconst nextItemNameNormalized = \"Quartus\";\nlet featExists = false;\n\nactor.items.forEach(function (item) {\n  if (item.name === featName && item.type === \"feat\") {\n    console.log(`${orgName} | Feat ${featName} already exists`);\n    featExists = true;\n  }\n});\n\nif (featExists) return;\n\nconst tertiusPortalfeat = {\n  name: featName,\n  type: \"feat\",\n  system: {\n    description: {\n      value: `<p>As you grip the hilt of the <strong>${itemNameNormalized}</strong>, you feel its magical energy coursing through your veins. With a flick of the wrist, you throw the blade towards the wall before you. The air shimmers and ripples, as if it were a pool of water disturbed by a stone. Suddenly, a circular portal opens before you, leading to the location of the <strong>${nextItemNameNormalized}</strong> knife. You feel a powerful bond being formed between the dagger and yourself, assuring that only you can retrieve the blade from its resting place. No matter where the <strong>${nextItemNameNormalized}</strong> knife may be, the <strong>${itemNameNormalized}</strong> serves as a guide, unlocking the path to your next destination.</p>`,\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: itemName,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"\",\n      units: \"\",\n    },\n    target: {\n      value: null,\n      width: null,\n      units: \"\",\n      type: \"\",\n    },\n    range: {\n      value: 20,\n      long: 40,\n      units: \"ft\",\n    },\n    uses: {\n      value: null,\n      max: \"\",\n      per: \"\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"other\",\n    attackBonus: \"\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    type: {\n      value: \"feat\",\n      subtype: \"\",\n    },\n    requirements: \"\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  img: \"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-tertius-ability.webp\",\n  effects: [],\n  folder: null,\n  sort: 0,\n  flags: {\n    \"midi-qol\": {\n      effectActivation: false,\n      onUseMacroName: \"[templatePlaced]ItemMacro\",\n    },\n    itemacro: {\n      macro: {\n        name: \"Tertius Portal (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.portalDaggers.tertiusItemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n      },\n    },\n  },\n};\n\nawait actor.createEmbeddedDocuments(\"Item\", [tertiusPortalfeat]);\n"},"onDisable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Tertius Portal Dagger\";\nconst featName = \"Tertius Portal (Active Ability)\";\n\nconst tertiusPortalfeat = actor.items.getName(featName);\nif (tertiusPortalfeat) {\n  await tertiusPortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"}}}}],"flags":{"core":{"sourceId":"Compendium.dnd5e.items.Lr8aRsnia8hftPAb"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1661787233621,"modifiedTime":1687071074984,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"4NNl97Hv41Asue4i"}
{"name":"Destabilizator (Warhammer) v3","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/007-destabilizator/art-static-destabilizator.webp","system":{"description":{"value":"<p><em>Weapon (warhammer), rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><h4><em>As the enemy approached, Captain Abelard raised his warhammer, with a determined look on his face. \"You'll not be getting any closer, friend,\" he said with a smirk. The enemy charged forward, only to be knocked back with a sudden force. \"What was that?\" they cried, holding their head. \"Oh, just a little something I call Distanceectomy,\" replied Abelard, winking. \"It has a way of keeping people from getting too close.”</em></h4></div><hr /><p>The hammerhead is crafted in the shape of two palm hands in a stop position, as if halting the enemy in their tracks. In the center of the hammer's head rests a precious gemstone, radiating a faint and mesmerizing purple hue that seems to shift and change with the light. The handle of the hammer is made from a rare, black wood, which seems to absorb light, giving it a dark appearance.</p><p>You gain a +1 bonus to attack and damage rolls made with this magic weapon.</p><p>This warhammer requires 16 Strength or higher to wield.</p><hr /><p><strong>Destabilizing Attack (Passive Ability)</strong>: every time you hit with this hammer, and if the target size is Tiny, Small, Medium or Large, it must make a DC 15 Strength saving throw. On a failed save, you push the target 5 feet away from you and it takes [[/r 1d8]] force damage, on a successful save the target only take half of the force damage and it is not pushed away.</p><hr /><img src=\"modules/boss-loot-magic-items-free/artwork/007-destabilizator/art-static-destabilizator.webp\" alt=\"Destabilizator\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":4,"price":{"value":0,"denomination":"gp"},"attunement":2,"equipped":true,"rarity":"rare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":5,"long":null,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"mwak","attackBonus":"1","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d8 + @mod + 1","bludgeoning"]],"versatile":"1d10 + @mod + 1"},"formula":"1d8[force]","save":{"ability":"str","dc":15,"scaling":"flat"},"armor":{"value":10},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"weaponType":"martialM","baseItem":"warhammer","properties":{"ada":false,"amm":false,"fin":false,"fir":false,"foc":false,"hvy":false,"lgt":false,"lod":false,"mgc":true,"rch":false,"rel":false,"ret":false,"sil":false,"spc":false,"thr":false,"two":false,"ver":true},"proficient":false},"effects":[],"flags":{"magicitems":{"enabled":false,"equipped":false,"attuned":false,"charges":"0","chargeType":"c1","destroy":false,"destroyFlavorText":"reaches 0 charges: it crumbles into ashes and is destroyed.","rechargeable":false,"recharge":"0","rechargeType":"t1","rechargeUnit":"r1","sorting":"l"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[postSave]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false,"autoSaveFriendly":false},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"},"itemacro":{"macro":{"name":"Destabilizator (Warhammer) v3","type":"script","scope":"global","command":"const orgName = \"Boss Loot\";\nconst strLimit = 16;\nconst abilityName = \"Destabilizing Attack\";\nconst permittedSize = [\"tiny\", \"sm\", \"med\", \"lg\"];\nconst artWorkChatTitle = \"modules/boss-loot-magic-items-free/artwork/007-destabilizator/art-static-destabilizator.webp\";\nconst artWorkPushEffect = \"modules/boss-loot-magic-items-free/artwork/007-destabilizator/art-satic-destabilizing-attack-effect.webp\";\nconst artWorkChatCardPushEffect = \"modules/boss-loot-magic-items-free/artwork/007-destabilizator/art-animated-for-chat-destabilizator.gif\";\n\nconst info = args[0];\nconst actorStr = actor.system.abilities.str.value;\n\n//------------------------\n// Pre-Checks\n//-----------\nif (info.targets.length === 0 || info.targetUuids.length === 0) {\n  console.log(`${orgName} | No target to hit`);\n  return;\n}\n\nif (info.workflow.hitTargets.size === 0) {\n  console.log(`${orgName} | Misses target`);\n  return;\n}\n\nif (info.failedSaveUuids.length === 0) {\n  console.log(`${orgName} | Saving throw succeded`);\n}\n\nif (info.item.system.attunement !== CONFIG.DND5E.attunementTypes.ATTUNED) {\n  ui.notifications.warn(`You cannot use <strong>${abilityName}</strong> without attunement!`);\n  return;\n}\n\nif (actorStr < strLimit) {\n  ui.notifications.warn(`You don't have enough STR to use <strong>${abilityName}!</strong>`);\n  return;\n}\n\n//------------------------\n// F U N C T I O N S\n//-----------\nasync function pushToken(targetToken, newLocation) {\n  await new Sequence().animation().on(targetToken).fadeIn(500).moveSpeed(5).moveTowards(newLocation, { duration: 1, ease: \"easeOutQuint\", delay: 0, offset: 0 }).play();\n}\n\nasync function hammerHit(sourceToken, targetToken) {\n  await new Sequence()\n    .effect()\n    .file(\"jb2a.side_impact.part.shockwave.blue\")\n    .atLocation(targetToken)\n    .attachTo(sourceToken, { followRotation: false })\n    .rotateTowards(targetToken, { attachTo: true })\n    .scale(0.3)\n    .delay(-7000)\n\n    .effect()\n    .file(\"jb2a.impact.006.yellow\")\n    .atLocation(targetToken)\n    .scaleToObject(2)\n    .delay(0)\n    .waitUntilFinished(-2000)\n\n    .effect()\n    .file(\"jb2a.impact.ground_crack.orange.01\")\n    .filter(\"ColorMatrix\", { brightness: 1, contrast: 0 })\n    .template({ gridSize: 200, startPoint: 200, endPoint: 200 })\n    .atLocation(targetToken)\n    .scaleToObject(2)\n    .delay(10)\n    .fadeOut(1000)\n    .belowTokens()\n\n    .play();\n}\n\n//------------------------\n// M A I N\n//-----------\nconst [target] = info.targets; // TokenDocument5e\nconst targetName = target.name;\nconst targetSize = target.actor.system?.traits?.size;\nlet messageBot;\n\nif (!permittedSize.includes(targetSize.toLowerCase())) {\n  messageBot = \"<p>You swing with all your might, but the target's colossal size is too much for even your warhammer's power!</p>\";\n  await bossLootFree.helpers.createChatMessage(\"Failed\", messageBot, abilityName, artWorkChatTitle, artWorkChatCardPushEffect);\n  await hammerHit(token, target);\n  return;\n}\n\nif (info.failedSaveUuids.length === 0) {\n  messageBot = \"<p>With a swift maneuver, the target withstands your hammer's blow, staying steadfast against your attempt to push them back!</p>\";\n  await bossLootFree.helpers.createChatMessage(\"Failed\", messageBot, abilityName, artWorkChatTitle, artWorkChatCardPushEffect);\n  await hammerHit(token, target);\n  return;\n}\n\n// Movement\nconst [targetUuid] = info.targetUuids;\nconst gridSize = canvas.scene.grid.size; // 100 pixels\nconst targetSizeMultiplier = target.width || 1; // Assume the default size multiplier is 1\n\n// Coordinates\nconst myTokenCenter = { x: token.center.x, y: token.center.y }; // point (x,y)\nconst targetCenterPos = { x: target.x + Math.floor(gridSize / 2), y: target.y + Math.floor(gridSize / 2) }; // center of top left square point (x,y)\n\n// Determine target new position\nconst ray = new Ray(myTokenCenter, targetCenterPos);\nconst ppdX = ray.dx === 0 ? 0 : (ray.dx / Math.abs(ray.dx)) * gridSize; // pushed pixel distance X\nconst ppdY = ray.dy === 0 ? 0 : (ray.dy / Math.abs(ray.dy)) * gridSize; // pushed pixel distance Y\n\nconst targetNewPossiblePos = [{ x: targetCenterPos.x + ppdX, y: targetCenterPos.y + ppdY }];\nif (ray.slope && isFinite(ray.slope)) {\n  targetNewPossiblePos.push({ x: targetCenterPos.x + ppdX, y: targetCenterPos.y });\n  targetNewPossiblePos.push({ x: targetCenterPos.x, y: targetCenterPos.y + ppdY });\n}\n\nlet targetNewPos = {};\n\n// Check collision in all possible positions\nfor (let i = 0; i < targetNewPossiblePos.length; i++) {\n  let isCollision = false;\n\n  if (targetSizeMultiplier <= 1) {\n    // For 1x1 tokens or smaller\n    const ray = new Ray(targetCenterPos, targetNewPossiblePos[i]);\n    const collisionSettings = { mode: \"any\", type: \"move\" };\n    const collision = canvas.walls.checkCollision(ray, collisionSettings);\n    isCollision = collision;\n  } else {\n    // For larger than 1x1 tokens\n    // check for all squares occupied by the token\n    for (let dx = 0; dx < targetSizeMultiplier; dx++) {\n      for (let dy = 0; dy < targetSizeMultiplier; dy++) {\n        const potentialPos = {\n          x: targetNewPossiblePos[i].x + dx * gridSize,\n          y: targetNewPossiblePos[i].y + dy * gridSize,\n        };\n        const ray = new Ray(targetCenterPos, potentialPos);\n        const collisionSettings = { mode: \"any\", type: \"move\" };\n        const collision = canvas.walls.checkCollision(ray, collisionSettings);\n\n        if (collision) {\n          isCollision = true;\n          break;\n        }\n      }\n\n      if (isCollision) {\n        break;\n      }\n    }\n  }\n\n  if (!isCollision) {\n    // Normalize the token pos\n    targetNewPos = {\n      x: targetNewPossiblePos[i].x - Math.floor(gridSize / 2),\n      y: targetNewPossiblePos[i].y - Math.floor(gridSize / 2),\n    };\n    break;\n  }\n}\n\n// Check for success\nconst pushTarget = Object.keys(targetNewPos).length > 0;\nconst messageTop = pushTarget ? \"Success\" : \"Failed\";\n\nif (pushTarget) {\n  messageBot = \"<p>The force of your swing sends the target flying back 5 feet!</p>\";\n} else {\n  messageBot = \"<p>The surroundings block the force of your blow, preventing you from pushing the target away.</p>\";\n}\n\nawait bossLootFree.helpers.createChatMessage(messageTop, messageBot, abilityName, artWorkChatTitle, artWorkChatCardPushEffect);\n\nawait hammerHit(token, target);\n\nif (pushTarget) {\n  await pushToken(target, targetNewPos);\n}","author":"Iz3BYZWrVGwLMHiJ","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Item.wNIt8U0LDDuoJ6Ii"},"favtab":{"isFavorite":false}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1670011731655,"modifiedTime":1687071074974,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"9PWjxQczoLwVTWYc"}
{"name":"Prime Portal Dagger v3","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-prime.webp","system":{"description":{"value":"<p><em>Weapon (dagger), rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“The four ancient knives, whose power spans the planes of existence, are said to contain a secret knowledge that is older than time itself. Those who unlock their secrets will gain access to a realm of power and knowledge beyond the comprehension of mortal minds.”</em></p></div><hr /><p>You gain a +2 bonus to attack and damage rolls made with this magic weapon.</p><p>The Prime, Secundus, Tertius, and Quartus knives are powerful items, each imbued with a unique ability to open a portal to the next knife’s location. When inserted into any wall, the Prime knife will open a portal to the Secundus knife, the Secundus knife will open a portal to the Tertius knife, and so on. With the Quartus knife, the portal will take the user back to the location of the Prime knife.</p><p>A strong connection is formed between you and the dagger once the portal is opened and only you can retrieve the blade from its resting place.</p><img src=\"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-prime.webp\" alt=\"Prime Dagger\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":1,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"rare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":20,"long":60,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"mwak","attackBonus":"2","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + @mod +2","piercing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":null},"hp":{"value":null,"max":null,"dt":null,"conditions":""},"weaponType":"simpleM","baseItem":"dagger","properties":{"ada":false,"amm":false,"fin":true,"fir":false,"foc":false,"hvy":false,"lgt":true,"lod":false,"mgc":true,"rch":false,"rel":false,"ret":false,"sil":false,"spc":false,"thr":true,"two":false,"ver":false},"proficient":true},"effects":[{"label":"Prime Portal Effect (do not touch this)","icon":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-prime.webp","origin":"Item.WZZD52cieHIRUviH","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"v6lP2MaapT6w8IxK","changes":[],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":"Creates the gate to Secundus"},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onDelete":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Prime Portal Dagger\";\nconst featName = \"Prime Portal (Active Ability)\";\n\nconst primePortalfeat = actor.items.getName(featName);\nif (primePortalfeat) {\n  await primePortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"},"onEnable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Prime Portal Dagger v3\";\nconst featName = \"Prime Portal (Active Ability)\";\nconst itemNameNormalized = \"Prime Portal Dagger\";\nconst nextItemNameNormalized = \"Scundus\";\nlet featExists = false;\n\nactor.items.forEach(function (item) {\n  if (item.name === featName && item.type === \"feat\") {\n    console.log(`${orgName} | Feat ${featName} already exists`);\n    featExists = true;\n  }\n});\n\nif (featExists) return;\n\nconst primePortalfeat = {\n  name: featName,\n  type: \"feat\",\n  system: {\n    description: {\n      value: `<p>As you grip the hilt of the <strong>${itemNameNormalized}</strong>, you feel its magical energy coursing through your veins. With a flick of the wrist, you throw the blade towards the wall before you. The air shimmers and ripples, as if it were a pool of water disturbed by a stone. Suddenly, a circular portal opens before you, leading to the location of the <strong>${nextItemNameNormalized}</strong> knife. You feel a powerful bond being formed between the dagger and yourself, assuring that only you can retrieve the blade from its resting place. No matter where the <strong>${nextItemNameNormalized}</strong> knife may be, the <strong>${itemNameNormalized}</strong> serves as a guide, unlocking the path to your next destination.</p>`,\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: itemName,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"\",\n      units: \"\",\n    },\n    target: {\n      value: null,\n      width: null,\n      units: \"\",\n      type: \"\",\n    },\n    range: {\n      value: 20,\n      long: 40,\n      units: \"ft\",\n    },\n    uses: {\n      value: null,\n      max: \"\",\n      per: \"\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"other\",\n    attackBonus: \"\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    type: {\n      value: \"feat\",\n      subtype: \"\",\n    },\n    requirements: \"\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  img: \"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-prime-ability.webp\",\n  effects: [],\n  folder: null,\n  sort: 0,\n  flags: {\n    \"midi-qol\": {\n      effectActivation: false,\n      onUseMacroName: \"[templatePlaced]ItemMacro\",\n    },\n    itemacro: {\n      macro: {\n        name: \"Prime Portal (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.portalDaggers.primeItemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n      },\n    },\n  },\n};\n\nawait actor.createEmbeddedDocuments(\"Item\", [primePortalfeat]);\n"},"onDisable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Prime Portal Dagger\";\nconst featName = \"Prime Portal (Active Ability)\";\n\nconst primePortalfeat = actor.items.getName(featName);\nif (primePortalfeat) {\n  await primePortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"}}}}],"flags":{"scene-packer":{"hash":"07e36a15baa6f75eb01f05468356a2517b1845f3","sourceId":"Item.aRqm168TKq4ivArd"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"},"core":{"sourceId":"Item.fm99DaMBVVhlZSMV"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1675078427142,"modifiedTime":1687071074978,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"EXcjFNRpQrxT6vlR"}
{"name":"Secundus Portal Dagger v3","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-secundus.webp","system":{"description":{"value":"<p><em>Weapon (dagger), rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“The four ancient knives, whose power spans the planes of existence, are said to contain a secret knowledge that is older than time itself. Those who unlock their secrets will gain access to a realm of power and knowledge beyond the comprehension of mortal minds.”</em></p></div><hr /><p>You gain a +2 bonus to attack and damage rolls made with this magic weapon.</p><p>The Prime, Secundus, Tertius, and Quartus knives are powerful items, each imbued with a unique ability to open a portal to the next knife’s location. When inserted into any wall, the Prime knife will open a portal to the Secundus knife, the Secundus knife will open a portal to the Tertius knife, and so on. With the Quartus knife, the portal will take the user back to the location of the Prime knife.</p><p>A strong connection is formed between you and the dagger once the portal is opened and only you can retrieve the blade from its resting place.</p><img src=\"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-secundus.webp\" alt=\"Secundus Dagger\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":1,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"rare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":20,"long":60,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"mwak","attackBonus":"2","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + @mod +2","piercing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":10},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"weaponType":"simpleM","baseItem":"dagger","properties":{"fin":true,"lgt":true,"thr":true,"amm":false,"hvy":false,"fir":false,"foc":false,"lod":false,"rch":false,"rel":false,"ret":false,"spc":false,"two":false,"ver":false,"mgc":true,"ada":false,"sil":false},"proficient":true},"effects":[{"label":"Secundus Portal Effect (do not touch this)","icon":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-secundus.webp","origin":"Item.Z7OIRPYCS5BmmL9o","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"CtMLw0Io4GSL32bl","changes":[],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":"Creates the gate to Tertius"},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onDelete":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Secundus Portal Dagger\";\nconst featName = \"Secundus Portal (Active Ability)\";\n\nconst primePortalfeat = actor.items.getName(featName);\nif (primePortalfeat) {\n  await primePortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"},"onEnable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Secundus Portal Dagger v3\";\nconst featName = \"Secundus Portal (Active Ability)\";\nconst itemNameNormalized = \"Secundus Portal Dagger\";\nconst nextItemNameNormalized = \"Tertius\";\nlet featExists = false;\n\nactor.items.forEach(function (item) {\n  if (item.name === featName && item.type === \"feat\") {\n    console.log(`${orgName} | Feat ${featName} already exists`);\n    featExists = true;\n  }\n});\n\nif (featExists) return;\n\nconst secundusPortalfeat = {\n  name: featName,\n  type: \"feat\",\n  system: {\n    description: {\n      value: `<p>As you grip the hilt of the <strong>${itemNameNormalized}</strong>, you feel its magical energy coursing through your veins. With a flick of the wrist, you throw the blade towards the wall before you. The air shimmers and ripples, as if it were a pool of water disturbed by a stone. Suddenly, a circular portal opens before you, leading to the location of the <strong>${nextItemNameNormalized}</strong> knife. You feel a powerful bond being formed between the dagger and yourself, assuring that only you can retrieve the blade from its resting place. No matter where the <strong>${nextItemNameNormalized}</strong> knife may be, the <strong>${itemNameNormalized}</strong> serves as a guide, unlocking the path to your next destination.</p>`,\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: itemName,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"\",\n      units: \"\",\n    },\n    target: {\n      value: null,\n      width: null,\n      units: \"\",\n      type: \"\",\n    },\n    range: {\n      value: 20,\n      long: 40,\n      units: \"ft\",\n    },\n    uses: {\n      value: null,\n      max: \"\",\n      per: \"\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"other\",\n    attackBonus: \"\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    type: {\n      value: \"feat\",\n      subtype: \"\",\n    },\n    requirements: \"\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  img: \"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-secundus-ability.webp\",\n  effects: [],\n  folder: null,\n  sort: 0,\n  flags: {\n    \"midi-qol\": {\n      effectActivation: false,\n      onUseMacroName: \"[templatePlaced]ItemMacro\",\n    },\n    itemacro: {\n      macro: {\n        name: \"Secundus Portal (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.portalDaggers.secundusItemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n      },\n    },\n  },\n};\n\nawait actor.createEmbeddedDocuments(\"Item\", [secundusPortalfeat]);\n"},"onDisable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Secundus Portal Dagger\";\nconst featName = \"Secundus Portal (Active Ability)\";\n\nconst primePortalfeat = actor.items.getName(featName);\nif (primePortalfeat) {\n  await primePortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"}}}}],"flags":{"core":{"sourceId":"Compendium.dnd5e.items.Lr8aRsnia8hftPAb"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1661787233621,"modifiedTime":1687071074981,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"IiuCcsFE1Y1yijZ3"}
{"name":"Chainweaver Bracer v2","type":"equipment","img":"modules/boss-loot-magic-items-free/artwork/003-chainweaver-bracer/art-static-chainweaver-bracer.webp","system":{"description":{"value":"<p><em>Wondrous item, very rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“With a commanding gesture and a wave of her hand, the elven adventurer pointed her bracer at the imposing figure blocking the door. A shining chain burst forth from the magical bracer and with a crack of energy, wrapped around the figure, dragging him to the ground with a loud thump. \"Let's have a conversation,\" she said calmly.”</em></p></div><hr /><p>This bracer is made of a dark metal, with a single gem affixed to the top of it. A magical chain can be seen coiled around the bracer, the links shimmering with a faint magical energy. When the gem is pressed, the chain extends out from the bracer, allowing the user to grab and pull a creature toward them.</p><hr /><p>This item has 2 charges. It regains expended charges after a short rest. As an action, you can expend 1 charge to use the bracer chain to attempt to grab and pull a creature 40 feet away toward you. You make a Strength (Athletics) check contested by the target's Strength (Athletics) or Dexterity (Acrobatics) check (the target chooses the ability to use). If you succeed, the target is @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.cSVcyZyNe2iG1fIc]{Restrained} until the start of your next turn.</p><img src=\"modules/boss-loot-magic-items-free/artwork/003-chainweaver-bracer/art-static-chainweaver-bracer.webp\" /><hr /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":1,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"veryRare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":1,"width":null,"units":"ft","type":"radius"},"range":{"value":40,"long":40,"units":"ft"},"uses":{"value":2,"max":"2","per":"sr","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":null,"type":"clothing","dex":null},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"baseItem":"","speed":{"value":null,"conditions":""},"strength":0,"stealth":false,"proficient":true},"effects":[],"flags":{"midi-qol":{"effectActivation":false,"onUseMacroName":"[templatePlaced]ItemMacro"},"itemacro":{"macro":{"name":"Chainweaver Bracer v2","type":"script","scope":"global","command":"const orgName = \"Boss Loot\";\nconst itemName = \"Chainweaver Bracer\";\nconst effectName = \"Holding Chain (Temporrary Effect)\";\nconst info = args[0];\nconst targetTokens = info.targets;\nconst targetUuid = info.targetUuids;\nconst usesCount = info.itemData.system.uses.value;\nconst permittedSize = [\"tiny\", \"sm\", \"med\"];\nconst artWorkChatTitle = \"modules/boss-loot-magic-items-free/artwork/003-chainweaver-bracer/art-static-chainweaver-bracer.webp\";\nconst artWorkChatCardChainhookBracer = \"modules/boss-loot-magic-items-free/artwork/003-chainweaver-bracer/art-animated-for-chat-chainweaver-bracer.gif\";\nconst artworkHoldingChainEffect = \"modules/boss-loot-magic-items-free/artwork/003-chainweaver-bracer/art-static-holding-chain-effect.webp\";\n\n//------------------------\n// F U N C T I O N S\n//-----------\nasync function returnOneUse() {\n  await actor.items.get(info.item._id).update({ \"system.uses.value\": usesCount + 1 });\n}\n\nasync function createChatMessage(summary, msg, img = true) {\n  const artwork = img ? `<img src=${artWorkChatCardChainhookBracer} title=${itemName} width=\"272\" height=\"272\" />` : \"\";\n  const chatChainhookBracer = {\n    content: `\n<div class=\"dnd5e chat-card item-card midi-qol-item-card\">\n  <header class=\"card-header flexrow\">\n    <img src=${artWorkChatTitle} title=\"${itemName}\" width=\"36\" height=\"36\" />\n    <h3 class=\"item-name\">${itemName} - ${summary}</h3>\n  </header>\n  <div class=\"card-content\">\n    ${msg}\n  </div>\n  <hr>\n    ${artwork}\n  <footer class=\"card-footer\"><span>${itemName}</span></footer>\n</div>`,\n    type: CONST.CHAT_MESSAGE_TYPES.OOC,\n  };\n  await ChatMessage.create(chatChainhookBracer);\n}\n\nfunction failChainEffect() {\n  new Sequence()\n    .effect()\n    .file(\"jb2a.bullet.Snipe.blue\")\n    .filter(\"ColorMatrix\", { hue: 135, brightness: 1, contrast: 0, saturate: 0 })\n    .template({ gridSize: 200, startPoint: 200, endPoint: 200 })\n    .attachTo(token)\n    .stretchTo(targetToken)\n    .effect()\n    .file(\"modules/sequencer/samples/Bindings/chain.png\")\n    .tint(\"#353935\")\n    .filter(\"ColorMatrix\", { hue: 135, brightness: 1, contrast: 0, saturate: 0 })\n    .attachTo(token)\n    .stretchTo(targetToken, { attachTo: true, tiling: true })\n    .scale(0.15)\n    .belowTokens()\n    .play();\n}\n\n//------------------------\n// P R E - C H E C K S\n//-----------\n\n// Delete the Template\nawait canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [info.templateId]);\n\nif (targetTokens.length !== 1) {\n  await returnOneUse();\n  console.log(`${orgName} | Please select one target to pull`);\n  ui.notifications.warn(`Please select one target to pull!`);\n  return;\n}\n\nif (targetUuid && targetUuid.includes(token.document.uuid)) {\n  await returnOneUse();\n  console.log(`${orgName} | Cannot use the item ${itemName} on yourself`);\n  ui.notifications.warn(`Cannot use the item ${itemName} on yourself!`);\n  return;\n}\n\n// Check the distance\nlet success = false;\nconst [targetToken] = targetTokens; // TokenDocument\nconst targetX = targetToken.x;\nconst targetY = targetToken.y;\nconst myTokenX = token.document.x;\nconst myTokenY = token.document.y;\nconst units = canvas.scene.grid.units;\nconst ray = new Ray({ x: myTokenX, y: myTokenY }, { x: targetX, y: targetY });\nconst [distanceFeet] = canvas.grid.measureDistances([{ ray }], { gridSpaces: true });\n\nif (distanceFeet > 40) {\n  await returnOneUse();\n  console.log(`${orgName} | Please target a token in a 40 feet range`);\n  ui.notifications.warn(`Please target a token in a 40 feet range!`);\n  return;\n}\n\n//------------------------\n// M A I N\n//-----------\n\nconst holdingChainEffect = {\n  label: effectName,\n  icon: artworkHoldingChainEffect,\n  duration: {\n    rounds: 1,\n    startTime: null,\n    seconds: null,\n    combat: null,\n    turns: null,\n    startRound: null,\n    startTurn: null,\n  },\n  origin: info.itemUuid,\n  disabled: false,\n  changes: [],\n  tint: null,\n  transfer: false,\n  flags: {\n    effectmacro: {\n      onDelete: {\n        script: `// Delete Seq Effects\\nawait Sequencer.EffectManager.endEffects({ name: \"Chainhook-Bracer-Chain\" });\\n\\n// Delete Restrained effect from target\\nconst hasEffectApplied = game.dfreds.effectInterface.hasEffectApplied(\"Restrained\", \"${targetToken.uuid}\");\\nif (hasEffectApplied) {\\n  await game.dfreds.effectInterface.removeEffect({ effectName: \"Restrained\", uuid: \"${targetToken.uuid}\" });\\n  console.log(\\`${orgName} | \"Restrained\" effect removed from ${targetToken.name}\\`);\\n}\\n`,\n      },\n    },\n  },\n};\n\n// Check the size\nconst targetSize = targetToken.actor.system?.traits?.size;\nconst isProperSize = permittedSize.includes(targetSize.toLowerCase());\nif (!isProperSize) {\n  failChainEffect();\n  const textToChat = `<p>You extend the <strong>${itemName}'s</strong> magic chain towards the <strong>${targetToken.name}</strong>, but it's too massive and powerful, the chain struggles to even reach it, let alone pull it towards you. The creature looks at you with contempt as it remains in its place.</p>`;\n  await createChatMessage(\"FAIL\", textToChat, false);\n  return;\n}\n\nif (targetToken.disposition === CONST.TOKEN_DISPOSITIONS.FRIENDLY) {\n  const content = `<div class=\"dnd5e chat-card item-card midi-qol-item-card\">\n  <header class=\"card-header flexrow\">\n    <img src=\"${artWorkChatTitle}\" title=\"${itemName}\" width=\"36\" height=\"36\" />\n    <h3 class=\"item-name\">${itemName}</h3>\n  </header>\n  <div class=\"card-content\">\n    <p><span style=\"font-family: Arial; font-weight: ${CONST.FONT_WEIGHTS.Black}\">The ${itemName} hums with magic as you consider using it to pull your friend to safety.</span></p>\n    <p><span style=\"font-family: Arial; font-weight: ${CONST.FONT_WEIGHTS.Black}\">Is your friend willing to be pulled?</span></p>\n    <br>\n  </div>\n  </div>`;\n  // Ask\n  await new Dialog({\n    title: \"Atempt to pull a friendly\",\n    content,\n    buttons: {\n      Yes: {\n        label: `Yes`,\n        callback: async () => await main(true),\n      },\n      No: {\n        label: `No`,\n        callback: async () => await main(false),\n      },\n    },\n  }).render(true);\n} else {\n  await main(false);\n}\n\nasync function main(isWilling) {\n  //Begin contested Roll check\n  if (!isWilling) {\n    const targetSkill = targetToken.actor.system.skills.acr.mod > targetToken.actor.system.skills.ath.mod ? \"acr\" : \"ath\";\n\n    const target_roll = await targetToken.actor.rollSkill(targetSkill, { fastForward: true, rollMode: \"blindroll\" });\n    const main_roll = await actor.rollSkill(`ath`, { fastForward: true, flavor: `Athletics contested check : <strong>DC ${target_roll.total}</strong>` });\n\n    // Check for success\n    success = main_roll.total >= target_roll.total;\n  } else {\n    success = true;\n  }\n\n  if (!success) {\n    failChainEffect();\n    const textToChat = `<p>You extend the <strong>${itemName}'s</strong> magic chain towards the <strong>${targetToken.name}</strong>, with a quick and precise movement, but it manages to dodge and evade the chain's grasp, remaining out of reach.</p>`;\n    await createChatMessage(\"FAIL\", textToChat, false);\n    return;\n  }\n\n  // Chain Effect\n  new Sequence()\n    .effect()\n    .file(\"jb2a.bullet.Snipe.blue\")\n    .filter(\"ColorMatrix\", { hue: 135, brightness: 1, contrast: 0, saturate: 0 })\n    .template({ gridSize: 200, startPoint: 200, endPoint: 200 })\n    .attachTo(token)\n    .stretchTo(targetToken)\n    .effect()\n    .file(\"modules/sequencer/samples/Bindings/chain.png\")\n    .tint(\"#353935\")\n    .filter(\"ColorMatrix\", { hue: 135, brightness: 1, contrast: 0, saturate: 0 })\n    .attachTo(token)\n    .stretchTo(targetToken, { attachTo: true, tiling: true })\n    .scale(0.15)\n    .belowTokens()\n    .waitUntilFinished(-400)\n    .effect()\n    .file(\"modules/sequencer/samples/Bindings/chain.png\")\n    .tint(\"#353935\")\n    .filter(\"ColorMatrix\", { hue: 135, brightness: 1, contrast: 0, saturate: 0 })\n    .name(\"Chainhook-Bracer-Chain\")\n    .attachTo(token)\n    .stretchTo(targetToken, { attachTo: true, tiling: true })\n    .scale(0.15)\n    .belowTokens()\n    .persist()\n    .effect()\n    .file(\"jb2a.markers.chain.standard.loop.02.red\")\n    .name(\"Chainhook-Bracer-Chain\")\n    .filter(\"ColorMatrix\", { hue: 125, brightness: 1, contrast: 1, saturate: 0 })\n    .attachTo(targetToken)\n    .scaleToObject(1.5)\n    .persist()\n    .wait(500)\n    .animation()\n    .on(targetToken)\n    .moveTowards(token, { ease: \"easeOutCirc\" })\n    .moveSpeed(10)\n    .closestSquare()\n    .async()\n    .play();\n\n  // Create the Holding Chain effect\n  await actor.createEmbeddedDocuments(\"ActiveEffect\", [holdingChainEffect]);\n\n  // Add Restrained effect\n  await game.dfreds.effectInterface.addEffect({ effectName: \"Restrained\", uuid: targetToken.uuid });\n\n  const textToChat = `<p>With a swift flick of your wrist, the <strong>${itemName}</strong> extends its magic chain towards the <strong>${targetToken.name}</strong>, latching onto it with a loud clink. The creature stumbles and is pulled towards you with a force, its eyes widen in surprise as it struggles to break free but to no avail.</p>`;\n  await createChatMessage(\"SUCCESS\", textToChat);\n}","author":"Iz3BYZWrVGwLMHiJ","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Item.PQ2nmton7QGAHz9h"},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1673374302823,"modifiedTime":1687072908629,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"MzZWyScL1axecseP"}
{"name":"Quartus Portal Dagger v3","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-quartus.webp","system":{"description":{"value":"<p><em>Weapon (dagger), rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“The four ancient knives, whose power spans the planes of existence, are said to contain a secret knowledge that is older than time itself. Those who unlock their secrets will gain access to a realm of power and knowledge beyond the comprehension of mortal minds.”</em></p></div><hr /><p>You gain a +2 bonus to attack and damage rolls made with this magic weapon.</p><p>The Prime, Secundus, Tertius, and Quartus knives are powerful items, each imbued with a unique ability to open a portal to the next knife’s location. When inserted into any wall, the Prime knife will open a portal to the Secundus knife, the Secundus knife will open a portal to the Tertius knife, and so on. With the Quartus knife, the portal will take the user back to the location of the Prime knife.</p><p>A strong connection is formed between you and the dagger once the portal is opened and only you can retrieve the blade from its resting place.</p><img src=\"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-quartus.webp\" alt=\"Quartus Dagger\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":1,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"rare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":20,"long":60,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"mwak","attackBonus":"2","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d4 + @mod +2","piercing"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":null},"hp":{"value":null,"max":null,"dt":null,"conditions":""},"weaponType":"simpleM","baseItem":"dagger","properties":{"ada":false,"amm":false,"fin":true,"fir":false,"foc":false,"hvy":false,"lgt":true,"lod":false,"mgc":true,"rch":false,"rel":false,"ret":false,"sil":false,"spc":false,"thr":true,"two":false,"ver":false},"proficient":true},"effects":[{"label":"Quartus Portal Effect (do not touch this)","icon":"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-quartus.webp","origin":"Item.Tqo4TwVTa5FWrhO8","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"HIgSzcsfV2ZA4xXA","changes":[],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":"Creates the gate to Prime"},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onDelete":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Quartus Portal Dagger\";\nconst featName = \"Quartus Portal (Active Ability)\";\n\nconst quartusPortalfeat = actor.items.getName(featName);\nif (quartusPortalfeat) {\n  await quartusPortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"},"onEnable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Quartus Portal Dagger v3\";\nconst featName = \"Quartus Portal (Active Ability)\";\nconst itemNameNormalized = \"Quartus Portal Dagger\";\nconst nextItemNameNormalized = \"Prime\";\nlet featExists = false;\n\nactor.items.forEach(function (item) {\n  if (item.name === featName && item.type === \"feat\") {\n    console.log(`${orgName} | Feat ${featName} already exists`);\n    featExists = true;\n  }\n});\n\nif (featExists) return;\n\nconst quartusPortalfeat = {\n  name: featName,\n  type: \"feat\",\n  system: {\n    description: {\n      value: `<p>As you grip the hilt of the <strong>${itemNameNormalized}</strong>, you feel its magical energy coursing through your veins. With a flick of the wrist, you throw the blade towards the wall before you. The air shimmers and ripples, as if it were a pool of water disturbed by a stone. Suddenly, a circular portal opens before you, leading to the location of the <strong>${nextItemNameNormalized}</strong> knife. You feel a powerful bond being formed between the dagger and yourself, assuring that only you can retrieve the blade from its resting place. No matter where the <strong>${nextItemNameNormalized}</strong> knife may be, the <strong>${itemNameNormalized}</strong> serves as a guide, unlocking the path to your next destination.</p>`,\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: itemName,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"\",\n      units: \"\",\n    },\n    target: {\n      value: null,\n      width: null,\n      units: \"\",\n      type: \"\",\n    },\n    range: {\n      value: 20,\n      long: 40,\n      units: \"ft\",\n    },\n    uses: {\n      value: null,\n      max: \"\",\n      per: \"\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"other\",\n    attackBonus: \"\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    type: {\n      value: \"feat\",\n      subtype: \"\",\n    },\n    requirements: \"\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  img: \"modules/boss-loot-magic-items-free/artwork/006-portal-daggers/art-static-portal-dagger-quartus-ability.webp\",\n  effects: [],\n  folder: null,\n  sort: 0,\n  flags: {\n    \"midi-qol\": {\n      effectActivation: false,\n      onUseMacroName: \"[templatePlaced]ItemMacro\",\n    },\n    itemacro: {\n      macro: {\n        name: \"Quartus Portal (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.portalDaggers.quartusItemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n      },\n    },\n  },\n};\n\nawait actor.createEmbeddedDocuments(\"Item\", [quartusPortalfeat]);\n"},"onDisable":{"script":"const orgName = \"Boss Loot\";\nconst itemName = \"Quartus Portal Dagger\";\nconst featName = \"Quartus Portal (Active Ability)\";\n\nconst quartusPortalfeat = actor.items.getName(featName);\nif (quartusPortalfeat) {\n  await quartusPortalfeat.delete();\n  console.log(`${orgName} | ${featName} was deleted!`);\n} else {\n  console.log(`${orgName} | ${featName} not found`);\n}\n"}}}}],"flags":{"scene-packer":{"hash":"4fa7872636df09e7df235f07910d0e12f64cf6ec","sourceId":"Item.rkkn6X7CmUVcGMu5"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"},"core":{"sourceId":"Item.aWsozYvUs3qrWt52"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1675079047399,"modifiedTime":1687071074980,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"crNAWm3eRGmZfyot"}
{"name":"Helm of the Charging Bull v3","type":"equipment","img":"modules/boss-loot-magic-items-free/artwork/011-helm-of-the-charging-bull/art-static-helm-of-the-charging-bull.webp","system":{"description":{"value":"<p><em>Wondrous item, very rare (requires attunement)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>\"A symbol of strength and courage, those who have been fortunate enough to experience its power have found themselves unstoppable on the battlefield, charging forward with a strength and vigor unmatched by all others.\"</em></p></div><p>This ancient magical helm is made of a shimmering, silver metal, with two large horns extending out of the sides. It is adorned with carvings of ancient symbols and runes, giving it a mysterious and intimidating look. When worn, it grants its wielder the power to charge at a target and knock them to the ground with a powerful shockwave.</p><p>Only those with a Strength of 14 or higher are capable of attuning to and properly wearing this helm.</p><p><strong>Mighty Charge</strong>: As an action, gather your strength and focus, channeling the spirit of the bull. Use your movement to charge at least 20 feet towards a creature you can clearly see with no other obstacle in the way. The target must make a DC 15 Dexterity saving throw. On a failed save, the creature takes [[/r 4d4]] bludgeoning damage, is thrown 15 feet back, knocked @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.y0TkcdyoZlOTmAFT]{Prone}, and is @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.ZyZMUwA2rboh4ObS]{Stunned}until the end of its next turn. On a successful save, it takes half damage and is not thrown back. This ability works only against creatures of size Tiny, Small, or Medium.</p><p>This item has 2 charges. It regains expended charges after a long rest.</p><img id=\"img-static-helm-of-the-charging-bull\" src=\"modules/boss-loot-magic-items-free/artwork/011-helm-of-the-charging-bull/art-static-helm-of-the-charging-bull.webp\" alt=\"Helm of the Charging Bull\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":2,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"veryRare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":1,"width":null,"units":"ft","type":"radius"},"range":{"value":30,"long":30,"units":"ft"},"uses":{"value":2,"max":"2","per":"lr","recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":null,"type":"clothing","dex":null},"hp":{"value":null,"max":null,"dt":null,"conditions":""},"baseItem":"","speed":{"value":null,"conditions":""},"strength":null,"stealth":false,"proficient":true},"effects":[],"flags":{"scene-packer":{"hash":"4aeb3a35464509be34827a72403e8998fd275c45","sourceId":"Item.vZ6nm606V10fvSiz"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[templatePlaced]ItemMacro"},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"},"itemacro":{"macro":{"name":"Helm of the Charging Bull v3","type":"script","scope":"global","command":"const orgName = \"Boss Loot\";\nconst itemName = \"Helm of the Charging Bull\";\nconst abilityName = \"Mighty Charge\";\nconst info = args[0];\nconst targetUuid = info.targetUuids;\nconst usesCount = info.itemData.system.uses.value;\nconst permittedSize = [\"tiny\", \"sm\", \"med\"];\nconst flatDC = 15;\nconst bludgeoningDamage = \"4d4\";\nconst actorMovementWalk = actor.system.attributes.movement.walk;\nconst actorMovementFly = actor.system.attributes.movement.fly;\nconst actorMovementUnits = actor.system.attributes.movement.units;\nconst extraSquare = canvas.scene.grid.distance;\nconst artWorkChatTitle = \"modules/boss-loot-magic-items-free/artwork/011-helm-of-the-charging-bull/art-static-helm-of-the-charging-bull.webp\";\nconst artWorkChatCardChargingBull = \"modules/boss-loot-magic-items-free/artwork/011-helm-of-the-charging-bull/art-animated-for-chat-helm-of-the-charging-bull.gif\";\n\n//------------------------\n// F U N C T I O N S\n//-----------\nasync function hideDivFromChatMessage(cardId, className) {\n  const chatMessage = game.messages.get(cardId);\n  const tempDiv = document.createElement(\"div\");\n  tempDiv.innerHTML = chatMessage.content;\n\n  const cardContent = tempDiv.querySelector(className);\n  cardContent?.classList.add(\"hidden\");\n\n  console.log(`${orgName} | Add class hidden to Saves Display in ChatMessage with id ${cardId}`);\n  await chatMessage.update({ content: tempDiv.innerHTML });\n}\n\nfunction thrownToken(chargingToken, targetToken) {\n  const gridSize = canvas.scene.grid.size;\n  const newDistance = gridSize * 3;\n  const targetTokenCenter = targetToken.center; // compute only once the center\n\n  // From token to target\n  const ray1 = new Ray(chargingToken.center, targetTokenCenter);\n  const originalDistance = ray1.distance;\n  const ratio = newDistance / originalDistance;\n\n  // From target to the new position\n  const ray2 = new Ray({ x: ray1.B.x, y: ray1.B.y }, { x: ray1.B.x + ray1.dx * ratio, y: ray1.B.y + ray1.dy * ratio });\n\n  // Check collision\n  const collisionSettings = { mode: \"universal\", type: \"move\" }; // mode: universal\n  const collision = canvas.walls.checkCollision(ray2, collisionSettings);\n\n  let dx, dy, destPosition;\n  if (collision) {\n    dx = collision.x - targetTokenCenter.x;\n    dy = collision.y - targetTokenCenter.y;\n    console.log(`${orgName} | Collision detected, stopping the movement`);\n    let distanceX = dx > 0 ? Math.floor(dx / gridSize) * gridSize : Math.ceil(dx / gridSize) * gridSize;\n    let distanceY = dy > 0 ? Math.floor(dy / gridSize) * gridSize : Math.ceil(dy / gridSize) * gridSize;\n\n    destPosition = { x: targetToken.x + distanceX, y: targetToken.y + distanceY };\n  } else {\n    destPosition = canvas.grid.getSnappedPosition(ray2.B.x - targetToken.w / 2, ray2.B.y - targetToken.h / 2, 1);\n  }\n\n  return { x: destPosition.x, y: destPosition.y };\n}\n\nasync function chargeAnimation(chargingToken, targetToken) {\n  await new Sequence()\n    // Charge\n    .animation()\n    .on(chargingToken)\n    .moveTowards(targetToken, { ease: \"easeInOutBack\" })\n    .moveSpeed(15)\n    .waitUntilFinished(-300)\n    .closestSquare()\n    .effect()\n    .file(\"jb2a.wind_stream.white\")\n    .timeRange(0, 400)\n    .atLocation(chargingToken, { cacheLocation: true })\n    .stretchTo(targetToken, { cacheLocation: true })\n    .scale({ x: 1, y: 0.2 })\n    .belowTokens()\n    .play();\n}\n\nasync function thrownAnimation(chargingToken, targetPosition) {\n  await new Sequence()\n    //Start dust under token\n    .effect()\n    .file(\"jb2a.smoke.puff.ring.01.white.0\")\n    .atLocation(chargingToken)\n    .scaleToObject(1.75)\n    .belowTokens()\n    .waitUntilFinished(-1000)\n    //Turn token invisible\n    .animation()\n    .on(chargingToken)\n    .opacity(0)\n    .teleportTo(targetPosition)\n    //Token jump\n    .effect()\n    .from(chargingToken)\n    .atLocation(chargingToken)\n    .scale(1.5)\n    .scaleIn({ x: 0.5, y: 0.5 }, 250, { ease: \"easeOutCubic\" })\n    .scaleOut({ x: 0.5, y: 0.5 }, 450, { ease: \"easeInCubic\" })\n    .opacity(1)\n    .duration(800)\n    .anchor({ x: 0.5, y: 0.5 })\n    .loopProperty(\"sprite\", \"rotation\", { from: 0, to: 360, duration: 800, ease: \"easeOutQuad\" })\n    .moveTowards(targetPosition, { rotate: false, ease: \"easeOutSine\" })\n    .zIndex(2)\n    //Token shadow\n    .effect()\n    .from(chargingToken)\n    .atLocation(chargingToken)\n    .opacity(0.5)\n    .scale(0.9)\n    //.belowTokens()\n    .duration(800)\n    .anchor({ x: 0.5, y: 0.1 })\n    .filter(\"ColorMatrix\", { brightness: -1 })\n    .filter(\"Blur\", { blurX: 5, blurY: 10 })\n    .loopProperty(\"sprite\", \"rotation\", { from: 0, to: 360, duration: 800, ease: \"easeOutCirc\" })\n    .moveTowards(targetPosition, { rotate: false, ease: \"easeOutSine\" })\n    .zIndex(2)\n    .waitUntilFinished(-100)\n    //End dust under token\n    .effect()\n    .file(\"jb2a.smoke.puff.ring.01.white.2\")\n    .atLocation(chargingToken)\n    .scaleToObject(1.75)\n    .effect()\n    .file(\"jb2a.smoke.puff.ring.01.white.1\")\n    .atLocation(chargingToken)\n    .effect()\n    .file(\"jb2a.smoke.puff.side.02.white.0\")\n    .atLocation(chargingToken)\n    .rotateTowards(chargingToken, { rotationOffset: 180, cacheLocation: true })\n    .scaleToObject(2.5)\n    //Turn token visible\n    .animation()\n    .on(chargingToken)\n    .opacity(1)\n    .delay(200)\n    .play();\n}\n\n// Delete the Template\nconst templateX = info.workflow.templateData.x;\nconst templateY = info.workflow.templateData.y;\nawait canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [info.templateId]);\n\n//------------------------\n// P R E - C H E C K S\n//-----------\nif (info.targets.length !== 1) {\n  console.log(`${orgName} | Please select one target`);\n  ui.notifications.warn(`Please select one target!`);\n  return;\n}\n\nif (targetUuid && targetUuid.includes(token.document.uuid)) {\n  console.log(`${orgName} | Cannot use the item ${itemName} on yourself`);\n  ui.notifications.warn(`Cannot use the item ${itemName} on yourself!`);\n  return;\n}\n\n// Check the distance\nconst ray = new Ray({ x: token.center.x, y: token.center.y }, { x: templateX, y: templateY });\nconst collision = canvas.walls.checkCollision(ray, { mode: \"any\", type: \"move\" });\nconst [distanceFeet] = canvas.grid.measureDistances([{ ray }], { gridSpaces: true });\nif (collision) {\n  console.log(`${orgName} | You cannot charge through walls`);\n  ui.notifications.warn(`You cannot charge through walls`);\n  return;\n}\nif (distanceFeet < 20) {\n  console.log(`${orgName} | You need to charge at least 20 feet to the target (${distanceFeet}ft)`);\n  ui.notifications.warn(`You need to charge at least 20 feet to the target`);\n  return;\n}\n\nif (distanceFeet > actorMovementWalk + actorMovementFly + extraSquare) {\n  console.log(`${orgName} | You don't have enough movement left. Desired move: (${distanceFeet}). Remaining movement: (${actorMovementWalk + actorMovementFly}${actorMovementUnits})`);\n  ui.notifications.warn(`You don't have enough movement left.`);\n  return;\n}\n\n//------------------------\n// M A I N\n//-----------\nconst [target] = info.workflow.targets;\nconst targetSize = target.document.actor.system?.traits?.size;\nawait hideDivFromChatMessage(info.itemCardId, \"#img-static-helm-of-the-charging-bull\");\n\nif (!permittedSize.includes(targetSize.toLowerCase())) {\n  const message = \"<p>Foe too large to be thrown!</p>\";\n  await chargeAnimation(token, target);\n  await bossLootFree.helpers.createChatMessage(\"Failed\", message, abilityName, artWorkChatTitle, artWorkChatCardChargingBull);\n  return;\n}\n\n// Do the magic\nconst newTargetLoc = thrownToken(token, target);\nconst abilitySaveMessageFlavor = `Dexterity Saving Throw vs DC ${flatDC}`;\nconst target_roll = await target.document.actor.rollAbilitySave(\"dex\", { fastForward: true, rollMode: \"blindroll\", flavor: abilitySaveMessageFlavor });\nconst chatMessage = [...game.messages].at(-1);\n\nif (chatMessage.flavor === abilitySaveMessageFlavor) {\n  const success = target_roll._total < flatDC ? \"Failed\" : \"Success\";\n  const messageNewContent = abilitySaveMessageFlavor + ` : <strong>${success}</strong>`;\n  await chatMessage.update({ flavor: messageNewContent });\n}\n\n// Roll for (Bludgeoning) Damage\nconst flavorText = `<p>${abilityName} bludgeoning damage roll</p>`;\ndamageAmount = new Roll(bludgeoningDamage).evaluate({ async: false });\n\nawait damageAmount.toMessage({\n  flavor: flavorText,\n  speaker: ChatMessage.getSpeaker({ actor: token.actor }),\n});\n\nif (target_roll._total < flatDC) {\n  const message = `<p>Charged with the helm's power, the enemy is thrown back, stunned and prone.</p>`;\n  await bossLootFree.helpers.createChatMessage(\"Success\", message, abilityName, artWorkChatTitle, artWorkChatCardChargingBull);\n  await chargeAnimation(token, target);\n  await thrownAnimation(target, newTargetLoc);\n\n  // Customize drefs effects\n  const incapacitatedEffectData = game.dfreds.effectInterface.findEffectByName(\"Stunned\").toObject();\n  incapacitatedEffectData.flags.dae = {\n    transfer: false,\n    specialDuration: [\"turnEnd\"],\n    stackable: \"multi\",\n    macroRepeat: \"none\",\n  };\n\n  await game.dfreds.effectInterface.addEffect({ effectName: \"Prone\", uuid: targetUuid[0], origin: info.item.uuid });\n  await game.dfreds.effectInterface.addEffectWith({ effectData: incapacitatedEffectData, uuid: targetUuid[0], origin: info.item.uuid });\n  await MidiQOL.applyTokenDamage([{ damage: damageAmount.total, type: \"bludgeoning\" }], damageAmount.total, new Set(info.targets), item, new Set(), {});\n} else {\n  const message = `<p>Foe withstood charge!</p>`;\n  await bossLootFree.helpers.createChatMessage(\"Failed\", message, abilityName, artWorkChatTitle, artWorkChatCardChargingBull);\n  await chargeAnimation(token, target);\n  await MidiQOL.applyTokenDamage([{ damage: Math.floor(damageAmount.total / 2), type: \"bludgeoning\" }], damageAmount.total, new Set(info.targets), item, new Set(), {});\n}","author":"Iz3BYZWrVGwLMHiJ","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Compendium.boss-loot-magic-items-free.boss-loot-items-advanced.q6kvEldELx8e4bbS"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1673799913479,"modifiedTime":1687071074976,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"gbNKoWZ7PAf8IEVa"}
{"name":"Void Vortex (Very Rare) v3","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/002-void-vortex/art-static-void-vortex.webp","system":{"description":{"value":"<p><em>Weapon (longbow), very rare (requires attunement)</em></p><div class=\"block purple\" id=\"book\" style=\"background:#aa88aa55\"><p><em>“</em><span data-text=\"true\"><em>You unleash a searing arrow of energy that slams into the ground. A swirling vortex of black and purple energy erupts from the point of impact, tearing apart the very fabric of reality and engulfing your foes in a maelstrom of force. Those who fail to escape its grasp are dragged towards it and rendered helpless before the void's consuming power.</em></span><em>”</em></p></div><hr /><p>You gain a +2 bonus to attack and damage rolls made with this magic weapon.</p><hr /><p><strong>Infinite Arrows</strong>: You do not require ammunition for firing this bow. The arrows are magical and deal force damage.</p><p><strong>Vortex Arrow (Active Ability)</strong>: As an action, you must say the activation phrase \"<span class=\"ryNqvb\"><strong>The Void of the Universe will consume you!</strong></span><strong>\"</strong>, you can materialize a vortex arrow. Choose a point within the weapon's normal range where the arrow will land. The arrow causes gravity to collapse, creating a vortex that lasts until the start of your next turn, dealing [[/r 6d8]] force damage in a 20 feet radius and forcing each creature within to make a Dexterity Saving Throw with a DC equal to your Spellcasting ability. On a fail save the creature is pulled towards the point of impact and is @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated} until the start of your next turn. Those who succeeded the Saving Throw will take <span style=\"font-family:Signika, sans-serif\">half as much damage and they will not get </span>@UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated}.</p><p><span class=\"ryNqvb\">After using this ability, the bow will enter a state of chaotic vibration and you will not be able to use \"Vortex Arrow\" ability until a day has passed.</span></p><img src=\"modules/boss-loot-magic-items-free/artwork/002-void-vortex/art-static-void-vortex.webp\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":2,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"veryRare","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":150,"long":600,"units":"ft"},"uses":{"value":null,"max":"","per":null,"recovery":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"rwak","attackBonus":"2","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[["1d8 + @mod + 2","force"]],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":10},"hp":{"value":0,"max":0,"dt":null,"conditions":""},"weaponType":"martialR","baseItem":"longbow","properties":{"amm":true,"hvy":true,"two":true,"fin":false,"fir":false,"foc":false,"lgt":false,"rch":false,"rel":false,"ret":false,"spc":false,"thr":false,"ver":false,"lod":false,"mgc":true,"ada":false,"sil":false},"proficient":false},"effects":[{"label":"Void Vortex (do not touch this)","icon":"modules/boss-loot-magic-items-free/artwork/002-void-vortex/art-static-void-vortex.webp","origin":"Item.TAEV8HgGIvGIZWdi","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"Fk2RkZ6o6CC1X3wb","changes":[],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false},"effectmacro":{"onDelete":{"script":"const featName = \"Vortex Arrow (Active Ability)\";\n\nlet myItems = actor.items;\n\n// Remove the item from item list\nmyItems.forEach(function (item) {\n  item.name === featName && item.type === \"feat\" && actor.deleteEmbeddedDocuments(\"Item\", [item.id]);\n});\n"},"onDisable":{"script":"const featName = \"Vortex Arrow (Active Ability)\";\n\nlet myItems = actor.items;\n\n// Remove the item from item list\nmyItems.forEach(function (item) {\n  item.name === featName && item.type === \"feat\" && actor.deleteEmbeddedDocuments(\"Item\", [item.id]);\n});\n"},"onEnable":{"script":"const orgName = \"Boss Loot\";\nconst featName = \"Vortex Arrow (Active Ability)\";\nconst featArtwork = \"modules/boss-loot-magic-items-free/artwork/002-void-vortex/art-static-gravity-distortion-effect.webp\";\nconst voidVortexItem = await fromUuid(effect.origin);\nconst itemRarity = voidVortexItem.system.rarity;\n\nlet myItems = actor.items;\nlet featExists = false;\n\nmyItems.forEach(function (item) {\n  if (item.name === featName && item.type === \"feat\") {\n    console.log(`${orgName} | A feature with name ${featName} already exists`);\n    featExists = true;\n  }\n});\n\nif (featExists) {\n  return;\n}\n\nconst voidVortexFeat = {\n  name: featName,\n  type: \"feat\",\n  img: featArtwork,\n  system: {\n    description: {\n      value:\n        '<p><strong>Vortex Arrow (Active Ability)</strong>: As an action, you must say the activation phrase \"<span class=\"ryNqvb\"><strong>The Void of the Universe will consume you!</strong></span><strong>\"</strong>, you can materialize a vortex arrow. Choose a point within the weapon\\'s normal range where the arrow will land. The arrow causes gravity to collapse, creating a vortex that lasts until the start of your next turn, dealing [[/r 6d8]] force damage in a 20 feet radius and forcing each creature within to make a Dexterity Saving Throw with a DC equal to your Spellcasting ability. On a fail save the creature is pulled towards the point of impact and is @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated} until the start of your next turn. Those who succeeded the Saving Throw will take <span style=\"font-family:Signika, sans-serif\">half as much damage and they will not get </span>@UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated}.</p><p><span class=\"ryNqvb\">After using this ability, the bow will enter a state of chaotic vibration and you will not be able to use \"Vortex Arrow\" ability until a day has passed.</span></p>',\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: voidVortexItem.name,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: 1,\n      units: \"round\",\n    },\n    target: {\n      value: 20,\n      width: null,\n      units: \"ft\",\n      type: \"radius\",\n    },\n    range: {\n      value: 150,\n      long: 600,\n      units: \"ft\",\n    },\n    uses: {\n      value: 1,\n      max: \"1\",\n      per: \"lr\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"save\",\n    attackBonus: \"0\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [[\"6d8\", \"force\"]],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"dex\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    requirements: \"\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  effects: [\n    {\n      label: \"Gravity Distortion Effect\",\n      icon: featArtwork,\n      duration: {\n        rounds: 1,\n        startTime: null,\n        seconds: null,\n        combat: null,\n        turns: null,\n        startRound: null,\n        startTurn: null,\n      },\n      disabled: false,\n      changes: [\n        {\n          key: \"macro.CE\",\n          mode: 0,\n          value: \"Incapacitated\",\n          priority: 20,\n        },\n      ],\n      tint: null,\n      transfer: false,\n      flags: {\n        \"times-up\": {},\n        dae: {\n          selfTarget: false,\n          selfTargetAlways: false,\n          stackable: \"none\",\n          durationExpression: \"\",\n          macroRepeat: \"none\",\n          specialDuration: [],\n        },\n        effectmacro: {\n          onCreate: {\n            script: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.vortexArrow.onCreate),\n          },\n          onDelete: {\n            script: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.vortexArrow.onDelete),\n          },\n        },\n      },\n      origin: null,\n    },\n  ],\n  flags: {\n    \"midi-qol\": {\n      fumbleThreshold: null,\n      effectActivation: false,\n      onUseMacroName: \"[postSave]ItemMacro,[templatePlaced]ItemMacro\",\n    },\n    itemacro: {\n      macro: {\n        name: \"Vortex Arrow (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.vortexArrow.itemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n      },\n    },\n  },\n};\n\nif (itemRarity === \"rare\") {\n  voidVortexFeat.effects = [];\n  voidVortexFeat.system.description.value =\n    '<p><strong>Vortex Arrow (Active Ability)</strong>. As an action, you must say the activation phrase \"<strong>The Void of the Universe will consume you!</strong>\" to materialize a vortex arrow. Choose a point within the weapon\\'s normal range where the arrow will land. The arrow causes gravity to collapse, creating a vortex which bursts shortly after its formation, dealing [[/r 4d8]] force damage in a 20-foot radius. Each creature within this area must make a Dexterity Saving Throw with a DC equal to your Spellcasting ability. On a failed save, a creature takes full damage. On a successful save, it takes half damage.</p>';\n  voidVortexFeat.system.duration.value = \"\";\n  voidVortexFeat.system.duration.units = \"inst\";\n  voidVortexFeat.system.damage.parts[0][0] = \"4d8\";\n  voidVortexFeat.flags[\"midi-qol\"].onUseMacroName = \"[templatePlaced]ItemMacro\";\n}\nactor.createEmbeddedDocuments(\"Item\", [voidVortexFeat]);\n"}}}}],"flags":{"core":{"sourceId":"Compendium.dnd5e.items.A2i08i8gAFscm6hZ"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[preAttackRoll]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"rollOther":false,"critOther":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false,"autoFailFriendly":false,"offHandWeapon":false,"autoSaveFriendly":false},"scene-packer":{"sourceId":"Item.z3KhKo7zFMvztrYd"},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.4"},"itemacro":{"macro":{"name":"Void Vortex v1","type":"script","scope":"global","command":"let targets = Array.from(game.user.targets);\n\nfor (let target of targets) {\n  new Sequence().effect().file(\"jb2a.arrow.physical.blue\").atLocation(token).stretchTo(target).play();\n}","author":"Iz3BYZWrVGwLMHiJ","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1686514927604,"modifiedTime":1687071704621,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"mknPluwqlZDaK6YS"}
{"name":"Stormforger v2","type":"weapon","img":"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-static-stormforger-staff.webp","system":{"description":{"value":"<p><em>Weapon (quarterstaff), legendary (requires attunement by a sorcerer, warlock, druid or wizard)</em></p><div class=\"block purple\" id=\" \" style=\"background:#aa88aa55\"><p><em>“\"Behold the power of the great storm!\" the wizard shouted, as the orb on top of the staff began to swirl with a furious intensity. \"Feel its wrath, and fear its might!\" The air around crackled with raw energy, and the winds began to howl. Lightning bolts flew from the staff, crashing into the ground and sending shock waves through the air. The storm was coming, and no one could stand in its way.”</em></p></div><hr /><p>The Stormforger is a majestic weapon, carved from a single piece of ancient, lightning-struck wood. The staff's surface is adorned with intricate engravings of swirling winds and bolts of lightning, and it is topped with a large, glowing orb made of pure crystal. The orb pulsates with energy, and it can be seen to contain miniature tempests within it. The staff is lightweight and it gives off a faint hum when held.</p><p>This staff is not made for melee attack but while you hold it, you gain a +2 bonus to range spell attack rolls.</p><p>The staff has 10 charges. It regains 1d4 + 2 expended charges after a long rest. If you expend the last charge, roll a d20. On a 20, the staff regains 2d4 + 2 charges.</p><hr /><p>While holding the staff, you can use an action to expend its charges to unleash the following abilities, using your spell save DC and spellcasting ability modifier:</p><p><strong>Tornado Takedown</strong>: Expending 2 charges allows the wielder to summon a tornado that travels to a creature within 60 feet. The creature must make a Dexterity saving throw, on a failed save it takes [[/r 1d6]] bludgeoning damage and [[/r 2d6]] lightning damage, and is @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated} until the end of your next turn. On a successful save it takes half as much damage and is not @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated}.</p><p><strong>Aerial Ascension</strong>: Expending 5 charges allows the wielder to harness the power of the tempest, summoning a whirlwind beneath their feet and allowing them to fly for 10 minutes. The maximum altitude that can be reached while flying is 30 feet.</p><p><strong>Thunderstorm of Misery</strong>: Expending 9 charges allows the wielder to unleash the full potential of the Stormforger, summoning a powerful storm that rages around them in a 50-foot radius for 1 minute. The storm creates dangerous terrain, making the ground slippery and filled with debris, making it difficult for creatures within the area of effect to move around. The howling winds, lightning strikes and heavy rain make it hard for creatures to see or hear, imposing disadvantage on any perception checks made while within the storm. The storm also unleashes bolts of lightning, forcing creatures within the affected area, to make a Dexterity saving throw. On a failed save they take [[/r 8d6]] lightning damage, or half as much on a successful one.</p><img src=\"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-static-stormforger-staff.webp\" alt=\"Stormforger\" /><section class=\"secret\" id=\"secret\"><h3><span style=\"text-decoration:underline\"><strong><span style=\"text-decoration:underline\">Very Important:</span></strong></span></h3><h4>Check Boss Loot Journal for mechanics and other goodies.</h4></section>","chat":"","unidentified":""},"source":"Boss Loot","quantity":1,"weight":1,"price":{"value":0,"denomination":"gp"},"attunement":1,"equipped":false,"rarity":"legendary","identified":true,"activation":{"type":"action","cost":1,"condition":""},"duration":{"value":"","units":""},"cover":null,"crewed":false,"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":5,"long":null,"units":"ft"},"uses":{"value":10,"max":"10","per":"charges","recovery":"1d8 + 2"},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":"2","chatFlavor":"","critical":{"threshold":null,"damage":""},"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"armor":{"value":null},"hp":{"value":null,"max":null,"dt":null,"conditions":""},"weaponType":"simpleM","baseItem":"quarterstaff","properties":{"ada":false,"amm":false,"fin":false,"fir":false,"foc":false,"hvy":false,"lgt":false,"lod":false,"mgc":true,"rch":false,"rel":false,"ret":false,"sil":false,"spc":false,"thr":false,"two":false,"ver":false},"proficient":true},"effects":[{"label":"Stormforger Range Spell Attack Bonus","icon":"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-static-range-spell-attack-bonus-effect.webp","origin":"Item.coj1iGcZhawzL4HQ","duration":{"startTime":null,"seconds":null,"combat":null,"rounds":null,"turns":null,"startRound":null,"startTurn":null},"disabled":false,"_id":"tbINrH7LfmoXQVgr","changes":[{"key":"system.bonuses.rsak.attack","mode":2,"value":"2","priority":20}],"tint":null,"transfer":true,"flags":{"times-up":{},"dfreds-convenient-effects":{"description":""},"dae":{"selfTarget":false,"selfTargetAlways":false,"stackable":"none","durationExpression":"","macroRepeat":"none","specialDuration":[]},"core":{"statusId":""},"ActiveAuras":{"isAura":false,"aura":"None","radius":"undefined","alignment":"","type":"","ignoreSelf":false,"height":false,"hidden":false,"displayTemp":false,"hostile":false,"onlyOnce":false}}}],"flags":{"scene-packer":{"hash":"c09d1672b3cb7a5851200bc13573f50fdb5a703e","sourceId":"Item.mNMKJ6c2hIGCxM4G"},"midi-qol":{"fumbleThreshold":null,"effectActivation":false,"onUseMacroName":"[preItemRoll]ItemMacro"},"midiProperties":{"nodam":false,"fulldam":false,"halfdam":false,"autoFailFriendly":false,"autoSaveFriendly":false,"rollOther":false,"critOther":false,"offHandWeapon":false,"magicdam":false,"magiceffect":false,"concentration":false,"toggleEffect":false,"ignoreTotalCover":false},"itemacro":{"macro":{"name":"Stormforger v2","type":"script","scope":"global","command":"const orgName = \"Boss Loot\";\nconst itemName = \"Stormforger\";\nconst tornadoTakedownName = \"Tornado Takedown\";\nconst aerialAscensionName = \"Aerial Ascension\";\nconst thunderstormOfMiseryName = \"Thunderstorm of Misery\";\nconst info = args[0];\nconst usesCount = info.itemData.system.uses.value;\nconst artWorkChatTitle = \"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-static-stormforger-staff.webp\";\nconst artWorkChatCardStormforgerStaff = \"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-animated-for-chat-stormforger-staff.gif\";\nconst artWorktornadoTakedownItem = \"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-satic-tornadon-takedown-effect.webp\";\nconst artWorkthunderstormOfMiseryFeat = \"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-static-thunderstorm-of-misery-effect.webp\";\n\nconst tornadoTakedownItem = {\n  name: \"Spell Scroll Tornado Takedown\",\n  type: \"consumable\",\n  img: artWorktornadoTakedownItem,\n  system: {\n    description: {\n      value:\n        '<p><strong>Tornado Takedown</strong>: Expending 2 charges allows the wielder to summon a tornado that travels to a creature within 60 feet. The creature must make a Dexterity saving throw, on a failed save it takes [[/r 1d6]] bludgeoning damage and [[/r 2d6]] lightning damage, and is @UUID[Compendium.dnd5e.rules.w7eitkpD7QQTB6j0.JournalEntryPage.TpkZgLfxCmSndmpb]{Incapacitated} until the end of your next turn. On a successful save it takes half as much damage and is not incapacitated.</p><hr /><img src=\"modules/boss-loot-magic-items-free/artwork/005-stormforger/art-animated-for-chat-stormforger-staff.gif\" title=\"Stormforger\" width=\"272\" height=\"272\" />',\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: info.item.name,\n    quantity: 1,\n    weight: 0,\n    attunement: 0,\n    equipped: true,\n    rarity: \"legendary\",\n    identified: true,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"\",\n      units: \"\",\n    },\n    cover: null,\n    crewed: false,\n    target: {\n      value: 1,\n      width: null,\n      units: \"ft\",\n      type: \"radius\",\n    },\n    range: {\n      value: 60,\n      long: 60,\n      units: \"ft\",\n    },\n    uses: {\n      value: 1,\n      max: \"1\",\n      per: \"charges\",\n      recovery: \"\",\n      autoDestroy: true,\n    },\n    actionType: \"save\",\n    chatFlavor: \"\",\n    damage: {\n      parts: [\n        [\"1d6 + 2\", \"bludgeoning\"],\n        [\"2d6\", \"lightning\"],\n      ],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"dex\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    consumableType: \"scroll\",\n  },\n  effects: [\n    {\n      label: \"Tornado Takedown (Temporary Effect)\",\n      icon: artWorktornadoTakedownItem,\n      duration: {\n        rounds: 1,\n        startTime: null,\n        seconds: null,\n        combat: null,\n        turns: null,\n        startRound: null,\n        startTurn: null,\n      },\n      disabled: false,\n      changes: [\n        {\n          key: \"macro.CE\",\n          mode: 0,\n          value: \"Incapacitated\",\n          priority: 20,\n        },\n      ],\n      tint: null,\n      transfer: false,\n      flags: {\n        \"times-up\": {},\n        \"dfreds-convenient-effects\": {\n          description: \"\",\n        },\n        dae: {\n          selfTarget: false,\n          selfTargetAlways: false,\n          stackable: \"noneName\",\n          durationExpression: \"\",\n          macroRepeat: \"none\",\n          specialDuration: [],\n        },\n        effectmacro: {\n          onDelete: {\n            script: \"await Sequencer.EffectManager.endEffects({ name: 'Tornado-Takedown' });\",\n          },\n        },\n      },\n    },\n  ],\n  flags: {\n    \"midi-qol\": {\n      fumbleThreshold: null,\n      effectActivation: false,\n      onUseMacroName: \"[postSave]ItemMacro\",\n    },\n    itemacro: {\n      macro: {\n        name: \"Spell Scroll Tornado Takedown\",\n        type: \"script\",\n        scope: \"global\",\n        command: bossLootFree.helpers.getFunctionBody(bossLootFree.macros.tornadoTakedown.itemMacro),\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n        flags: {},\n      },\n    },\n  },\n};\n\nconst thunderstormOfMiseryFeat = {\n  name: \"Thunderstorm of Misery (Active Ability)\",\n  type: \"feat\",\n  system: {\n    description: {\n      value:\n        \"<p><strong>Thunderstorm of Misery (Active Ability)</strong>: Expending 9 charges allows the wielder to unleash the full potential of the Stormbringer Staff, summoning a powerful storm that rages around them in a 50-foot radius for 1 minute. The storm creates dangerous terrain, making the ground slippery and filled with debris, making it difficult for creatures within the area of effect to move around. The howling winds, lightning strikes and heavy rain make it hard for creatures to see or hear, imposing disadvantage on any perception checks made while within the storm. The storm also unleashes bolts of lightning, forcing creatures within the affected area, to make a Dexterity saving throw. On a failed save they take [[/r 8d6]] lightning damage, or half as much damage on a successful one.</p>\",\n      chat: \"\",\n      unidentified: \"\",\n    },\n    source: info.item.name,\n    activation: {\n      type: \"action\",\n      cost: 1,\n      condition: \"\",\n    },\n    duration: {\n      value: \"10\",\n      units: \"round\",\n    },\n    target: {\n      value: 50,\n      width: null,\n      units: \"ft\",\n      type: \"creature\",\n    },\n    range: {\n      value: null,\n      long: null,\n      units: \"\",\n    },\n    uses: {\n      value: null,\n      max: \"\",\n      per: \"\",\n      recovery: \"\",\n    },\n    consume: {\n      type: \"\",\n      target: \"\",\n      amount: null,\n    },\n    ability: \"\",\n    actionType: \"save\",\n    attackBonus: \"\",\n    chatFlavor: \"\",\n    critical: {\n      threshold: null,\n      damage: \"\",\n    },\n    damage: {\n      parts: [[\"8d6\", \"lightning\"]],\n      versatile: \"\",\n    },\n    formula: \"\",\n    save: {\n      ability: \"dex\",\n      dc: null,\n      scaling: \"spell\",\n    },\n    type: {\n      value: \"feat\",\n      subtype: \"\",\n    },\n    requirements: \"9 Charges\",\n    recharge: {\n      value: null,\n      charged: false,\n    },\n  },\n  img: artWorkthunderstormOfMiseryFeat,\n  effects: [\n    {\n      label: \"Thunderstorm of Misery (Temporary Effect)\",\n      icon: artWorkthunderstormOfMiseryFeat,\n      duration: {\n        rounds: 10,\n      },\n      disabled: false,\n      changes: [],\n      tint: null,\n      transfer: false,\n      flags: {\n        dae: {\n          selfTargetAlways: true,\n        },\n        effectmacro: {\n          onDelete: {\n            script: 'const thunderFeat = await fromUuid(effect.origin);\\nawait Sequencer.EffectManager.endEffects({ name: \"Thunderstorm-of-Misery\" });\\nthunderFeat?.delete();\\n',\n          },\n        },\n      },\n    },\n  ],\n  folder: null,\n  sort: 0,\n  flags: {\n    \"midi-qol\": {\n      effectActivation: false,\n      onUseMacroName: \"[templatePlaced]ItemMacro\",\n    },\n    midiProperties: {\n      magicdam: true,\n    },\n    itemacro: {\n      macro: {\n        name: \"Thunderstorm of Misery (Active Ability)\",\n        type: \"script\",\n        scope: \"global\",\n        command:\n          'new Sequence()\\n .effect()\\n .name(\"Thunderstorm-of-Misery\")\\n .file(\"jb2a.call_lightning.low_res.blueorange\")\\n .atLocation(token)\\n .aboveLighting()\\n .scale(2.3)\\n .opacity(0.90)\\n .fadeIn(3000)\\n .fadeOut(400, {ease: \"easeOutCirc\", delay: 2000})\\n .persist()\\n.play();',\n        _id: null,\n        img: \"icons/svg/dice-target.svg\",\n        folder: null,\n        sort: 0,\n        ownership: {\n          default: 0,\n        },\n        flags: {},\n      },\n    },\n  },\n};\n\n//------------------------\n// F U N C T I O N S\n//-----------\nasync function consumeCharge(n) {\n  const newUses = usesCount - n;\n  if (newUses < 0) return false;\n\n  console.log(`${orgName} | Updating charges from ${usesCount} to ${newUses}`);\n  await actor.items.get(info.item._id).update({ \"system.uses.value\": newUses });\n\n  if (newUses === 0) await addRandomCharge();\n  return true;\n}\n\nasync function addRandomCharge() {\n  const flavorText = \"<p>If you expend the last charge, roll a d20. On a 20, the staff regains 2d4 + 2 charges.</p>\";\n  const roll1 = new Roll(\"1d20\").evaluate({ async: false });\n  const chatForZeroCharges = await roll1.toMessage({\n    flavor: flavorText,\n    speaker: ChatMessage.getSpeaker({ actor: token.actor }),\n  });\n\n  // Add some charges\n  if (roll1.total === 20) {\n    const roll2 = new Roll(\"2d4 + 2\").evaluate({ async: false });\n    await actor.items.get(info.item._id).update({ \"system.uses.value\": roll2.total });\n    await game.messages.get(chatForZeroCharges.id).update({ flavor: `${flavorText}<p style=\"color: #E94560;\">You regained ${roll2.total} charges.</p>` });\n    await game.messages.get(chatForZeroCharges.id).update({ rolls: [JSON.stringify(roll1), JSON.stringify(roll2)] });\n  }\n}\n\nasync function useTornadoTakedown() {\n  const remainingCharges = await consumeCharge(2);\n  if (!remainingCharges) {\n    ui.notifications.warn(`Not enough charges to use ${tornadoTakedownName}`);\n    return;\n  }\n  // Check if item already exist\n  let newItem = actor.items.getName(tornadoTakedownItem.name);\n\n  if (!newItem) {\n    // Create new Item5e\n    console.log(`${orgName} | Creating new item ${tornadoTakedownItem.name}`);\n    await actor.createEmbeddedDocuments(\"Item\", [tornadoTakedownItem]);\n    newItem = actor.items.getName(tornadoTakedownItem.name);\n  }\n\n  await newItem.use({}, { configureDialog: false });\n}\n\nasync function useAerialAscension() {\n  if (aerialAscensionAnimation.length > 0) {\n    await Sequencer.EffectManager.endEffects({ name: \"Aerial-Ascension\" });\n\n    //Turn Token visible\n    await new Sequence().animation().on(token).opacity(1).play();\n\n    await token.document.update({ elevation: 0 });\n  } else {\n    const remainingCharges = await consumeCharge(5);\n    if (!remainingCharges) {\n      ui.notifications.warn(`Not enough charges to use ${aerialAscensionName}`);\n      return;\n    }\n    await token.document.update({ elevation: token.document.elevation + 30 });\n\n    //Tornado\n    await new Sequence().effect().name(\"Aerial-Ascension\").file(\"jb2a.whirlwind.bluegrey\").scale(0.6).atLocation(token).attachTo(token, { bindAlpha: false, followRotation: false }).opacity(0.6).persist().zIndex(1).play();\n\n    //Turn Token invisible\n    await new Sequence()\n      .animation()\n      .on(token)\n      .opacity(0)\n      //MAKE A FAKE TOKEN AND ANIMATE IT\n      .effect()\n      .name(\"Aerial-Ascension\")\n      .from(token)\n      .attachTo(token, { bindAlpha: false })\n      .loopProperty(\"spriteContainer\", \"position.x\", {\n        values: [0, 25, -25, 0],\n        duration: 10000,\n        pingPong: true,\n      })\n      .loopProperty(\"spriteContainer\", \"position.y\", {\n        values: [0, -5, 5, -10, 10],\n        duration: 1500,\n        pingPong: true,\n        ease: \"easeInOutSine\",\n      })\n      .persist()\n      .zIndex(2)\n      .play();\n\n    //FAKE TOKEN SHADOW ANIMATION\n    await new Sequence()\n      .effect()\n      .name(\"Aerial-Ascension\")\n      .from(token)\n      .attachTo(token, { bindAlpha: false })\n      .opacity(0.8)\n      .scale(0.9)\n      .anchor({ x: 0.4, y: 0.1 })\n      .filter(\"ColorMatrix\", { brightness: -1 })\n      .filter(\"Blur\", { blurX: 5, blurY: 10 })\n      .loopProperty(\"spriteContainer\", \"position.x\", {\n        values: [0, 25, -25, 0],\n        duration: 10000,\n        pingPong: true,\n      })\n      .loopProperty(\"spriteContainer\", \"position.y\", {\n        values: [0, -5, 5, -10, 10],\n        duration: 1500,\n        pingPong: true,\n        ease: \"easeInOutSine\",\n      })\n      .persist()\n      .belowTokens()\n      .zIndex(0)\n      .play();\n  }\n}\n\nasync function useThunderstormOfMisery() {\n  const remainingCharges = await consumeCharge(9);\n  if (!remainingCharges) {\n    ui.notifications.warn(`Not enough charges to use ${thunderstormOfMiseryName}`);\n    return;\n  }\n  // Check if item already exist\n  let newItem = actor.items.getName(thunderstormOfMiseryFeat.name);\n\n  if (!newItem) {\n    // Create new Item5e\n    console.log(`${orgName} | Creating new item ${thunderstormOfMiseryFeat.name}`);\n    await actor.createEmbeddedDocuments(\"Item\", [thunderstormOfMiseryFeat]);\n    newItem = actor.items.getName(thunderstormOfMiseryFeat.name);\n  }\n\n  await newItem.use({}, { configureDialog: false });\n}\n\n//------------------------\n// A B I L I T Y     S E L E C T I O N\n//-----------\nfoundry.utils.setProperty(workflow.config, \"consumeUsage\", false);\n\nif (info.item.system.attunement !== CONFIG.DND5E.attunementTypes.ATTUNED || info.item.system.equipped === false) {\n  ui.notifications.warn(`Item \"${info.item.name}\" needs to be <strong>equipped</strong> and <strong>attuned</strong> before use!`);\n  return;\n}\n\nconst aerialAscensionAnimation = Sequencer.EffectManager.getEffects({ name: \"Aerial-Ascension\" });\nconst aerialAscensionText = aerialAscensionAnimation.length === 0 ? `Use ${aerialAscensionName} to rise (expending 5 charges)` : `Use ${aerialAscensionName} to descend (expending 0 charges)`;\nconst abilitySelection = `<div class=\"dnd5e chat-card item-card midi-qol-item-card\">\n    <header class=\"card-header flexrow\">\n      <img src=\"${artWorkChatTitle}\" title=\"${itemName}\" width=\"36\" height=\"36\" />\n      <h3 class=\"item-name\">${itemName}</h3>\n    </header>\n    <div class=\"card-content\">\n      <p style=\"font-family: Arial; font-weight: ${CONST.FONT_WEIGHTS.Bold}\">1. Ranged Spell Attack: Use ${tornadoTakedownName} (expending 2 charges)</p>\n      <p style=\"font-family: Arial; font-weight: ${CONST.FONT_WEIGHTS.Bold}\">2. ${aerialAscensionText}</p>\n      <p style=\"font-family: Arial; font-weight: ${CONST.FONT_WEIGHTS.Bold}\">3. Use ${thunderstormOfMiseryName} (expending 9 charges)</p>\n      <br />\n      <p style=\"font-family: Arial; font-weight: ${CONST.FONT_WEIGHTS.Bold}; font-size: large;\"><strong>Choose wisely:</strong></p>\n    </div>\n    </div>`;\n\nawait new Dialog(\n  {\n    title: \"Ability\",\n    content: abilitySelection,\n    buttons: {\n      button1: {\n        icon: \"<i class='fa-light fa-tornado'></i>\",\n        label: \"Tornado Takedown\",\n        callback: async () => await useTornadoTakedown(),\n      },\n      button2: {\n        icon: \"<i class='fa-light fa-hat-witch'></i>\",\n        label: \"Aerial Ascension\",\n        callback: async () => await useAerialAscension(),\n      },\n      button3: {\n        icon: \"<i class='fa-light fa-cloud-bolt'></i>\",\n        label: \"Thunderstorm of Misery\",\n        callback: async () => useThunderstormOfMisery(),\n      },\n    },\n  },\n  { width: 500 }\n).render(true);","author":"Iz3BYZWrVGwLMHiJ","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"ownership":{"default":0},"flags":{},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}},"core":{"sourceId":"Item.mNMKJ6c2hIGCxM4G"},"exportSource":{"world":"testing-1","system":"dnd5e","coreVersion":"10.291","systemVersion":"2.1.5"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.2.1","coreVersion":"10.291","createdTime":1674760065983,"modifiedTime":1687071074983,"lastModifiedBy":"caFj28CGHkOt5tn9"},"folder":null,"sort":0,"ownership":{"default":0,"caFj28CGHkOt5tn9":3},"_id":"rWrFi5VsrFGHJ1Xb"}
